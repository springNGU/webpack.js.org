(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{359:function(e,n,s){"use strict";s.r(n),n.default='<p>资源模块(asset module)是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外 loader。</p>\n<p>在 webpack 5 之前，通常使用：</p>\n<ul>\n<li><a href="/loaders/raw-loader/"><code>raw-loader</code></a> 将文件导入为字符串</li>\n<li><a href="/loaders/url-loader/"><code>url-loader</code></a> 将文件作为 data URI 内联到 bundle 中</li>\n<li><a href="/loaders/file-loader/"><code>file-loader</code></a> 将文件发送到输出目录</li>\n</ul>\n<p>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</p>\n<ul>\n<li><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现。</li>\n<li><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现。</li>\n<li><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现。</li>\n<li><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 <code>url-loader</code>，并且配置资源体积限制实现。</li>\n</ul>\n<blockquote class="warning">\n<p>这是一项实验功能。通过在 webpack 配置的 <a href="/configuration/experiments/">experiments</a> 选项中设置 <code>experiments.asset: true</code> 来开启资源模块。</p>\n</blockquote>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\')\n  },\n<span class="token inserted">+ experiments: {</span>\n<span class="token inserted">+   asset: true</span>\n<span class="token inserted">+ },</span>\n};</code></pre>\n<h2 id="resource-资源resource-asset">resource 资源(resource asset)<a href="#resource-%E8%B5%84%E6%BA%90resource-asset" aria-hidden="true"><span class="icon icon-link"></span></a></h2>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\')\n  },\n  experiments: {\n    asset: true\n  },\n<span class="token inserted">+ module: {</span>\n<span class="token inserted">+   rules: [</span>\n<span class="token inserted">+     {</span>\n<span class="token inserted">+       test: /\\.png/,</span>\n<span class="token inserted">+       type: \'asset/resource\'</span>\n<span class="token inserted">+     }</span>\n<span class="token inserted">+   ]</span>\n<span class="token inserted">+ },</span>\n};</code></pre>\n<p><strong>src/index.js</strong></p>\n<pre><code class="hljs language-js"><span class="token keyword">import</span> mainImage <span class="token keyword">from</span> <span class="token string">\'./images/main.png\'</span><span class="token punctuation">;</span>\n\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> mainImage<span class="token punctuation">;</span> <span class="token comment">// \'/dist/151cfcfa1bd74779aadb.png\'</span></code></pre>\n<p>所有 <code>.png</code> 文件都将被发送到输出目录，并且其路径将被注入到 bundle 中。</p>\n<h3 id="自定义输出文件名">自定义输出文件名<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E5%90%8D" aria-hidden="true"><span class="icon icon-link"></span></a></h3>\n<p>默认情况下，<code>asset/resource</code> 模块以 <code>[hash][ext]</code> 文件名发送到输出目录。</p>\n<p>可以通过在 webpack 配置中设置 <a href="/configuration/output/#outputassetmodulefilename"><code>output.assetModuleFilename</code></a> 来修改此模板字符串：</p>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\'),\n<span class="token inserted">+   assetModuleFilename: \'images/[hash][ext]\'</span>\n  },\n  experiments: {\n    asset: true\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.png/,\n        type: \'asset/resource\'\n      }\n    ]\n  },\n};</code></pre>\n<p>另一种自定义输出文件名的方式是，将某些资源发送到指定目录：</p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\'),\n<span class="token inserted">+   assetModuleFilename: \'images/[hash][ext]\'</span>\n  },\n  experiments: {\n    asset: true\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.png/,\n        type: \'asset/resource\'\n<span class="token deleted">-     }</span>\n<span class="token inserted">+     },</span>\n<span class="token inserted">+     {</span>\n<span class="token inserted">+       test: /\\.html/,</span>\n<span class="token inserted">+       type: \'asset/resource\',</span>\n<span class="token inserted">+       generator: {</span>\n<span class="token inserted">+         filename: \'static/[hash][ext]\'</span>\n<span class="token inserted">+       }</span>\n<span class="token inserted">+     }</span>\n    ]\n  },\n};</code></pre>\n<p>使用此配置，所有 <code>html</code> 文件都将被发送到输出目录中的 <code>static</code> 目录中。</p>\n<p><code>Rule.generator.filename</code> 与 <a href="/configuration/output/#outputassetmodulefilename"><code>output.assetModuleFilename</code></a> 相同，并且仅适用于 <code>asset</code> 和 <code>asset/resource</code> 模块类型。</p>\n<h2 id="inline-资源inlining-asset">inline 资源(inlining asset)<a href="#inline-%E8%B5%84%E6%BA%90inlining-asset" aria-hidden="true"><span class="icon icon-link"></span></a></h2>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\'),\n<span class="token deleted">-   assetModuleFilename: \'images/[hash][ext]\'</span>\n  },\n  experiments: {\n    asset: true\n  },\n  module: {\n    rules: [\n      {\n<span class="token deleted">-       test: /\\.png/,</span>\n<span class="token deleted">-       type: \'asset/resource\'</span>\n<span class="token inserted">+       test: /\\.svg/,</span>\n<span class="token inserted">+       type: \'asset/inline\'</span>\n<span class="token deleted">-     },</span>\n<span class="token inserted">+     }</span>\n<span class="token deleted">-     {</span>\n<span class="token deleted">-       test: /\\.html/,</span>\n<span class="token deleted">-       type: \'asset/resource\',</span>\n<span class="token deleted">-       generator: {</span>\n<span class="token deleted">-         filename: \'static/[hash][ext]\'</span>\n<span class="token deleted">-       }</span>\n<span class="token deleted">-     }</span>\n    ]\n  }\n};</code></pre>\n<p><strong>src/index.js</strong></p>\n<pre><code class="hljs language-diff"><span class="token deleted">- import mainImage from \'./images/main.png\';</span>\n<span class="token inserted">+ import metroMap from \'./images/matro.svg\';</span>\n\n<span class="token deleted">- img.src = mainImage; // \'/dist/151cfcfa1bd74779aadb.png\'</span>\n<span class="token inserted">+ block.style.background = `url(${metroMap})`; // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)</span></code></pre>\n<p>所有 <code>.svg</code> 文件都将作为 data URI 注入到 bundle 中。</p>\n<h3 id="自定义-data-uri-生成器">自定义 data URI 生成器<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89-data-uri-%E7%94%9F%E6%88%90%E5%99%A8" aria-hidden="true"><span class="icon icon-link"></span></a></h3>\n<p>webpack 输出的 data URI，默认是呈现为使用 Base64 算法编码的文件内容。</p>\n<p>如果要使用自定义编码算法，则可以指定一个自定义函数来编码文件内容：</p>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n<span class="token inserted">+ const svgToMiniDataURI = require(\'mini-svg-data-uri\');</span>\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\')\n  },\n  experiments: {\n    asset: true\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.svg/,\n        type: \'asset/inline\',\n<span class="token inserted">+       generator: {</span>\n<span class="token inserted">+         dataUrl: content => {</span>\n<span class="token inserted">+           content = content.toString();</span>\n<span class="token inserted">+           return svgToMiniDataURI(content);</span>\n<span class="token inserted">+         }</span>\n<span class="token inserted">+       }</span>\n      }\n    ]\n  },\n};</code></pre>\n<p>现在，所有 <code>.svg</code> 文件都将通过 <code>mini-svg-data-uri</code> 包进行编码。</p>\n<h2 id="source-资源source-asset">source 资源(source asset)<a href="#source-%E8%B5%84%E6%BA%90source-asset" aria-hidden="true"><span class="icon icon-link"></span></a></h2>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n<span class="token deleted">- const svgToMiniDataURI = require(\'mini-svg-data-uri\');</span>\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\')\n  },\n  experiments: {\n    asset: true\n  },\n  module: {\n    rules: [\n      {\n<span class="token deleted">-       test: /\\.svg/,</span>\n<span class="token deleted">-       type: \'asset/inline\',</span>\n<span class="token deleted">-       generator: {</span>\n<span class="token deleted">-         dataUrl: content => {</span>\n<span class="token deleted">-           content = content.toString();</span>\n<span class="token deleted">-           return svgToMiniDataURI(content);</span>\n<span class="token deleted">-         }</span>\n<span class="token deleted">-       }</span>\n<span class="token inserted">+       test: /\\.txt/,</span>\n<span class="token inserted">+       type: \'asset/source\',</span>\n      }\n    ]\n  },\n};</code></pre>\n<p><strong>src/example.txt</strong></p>\n<pre><code class="hljs language-text">Hello world\n</code></pre>\n<p><strong>src/index.js</strong></p>\n<pre><code class="hljs language-diff"><span class="token deleted">- import metroMap from \'./images/matro.svg\';</span>\n<span class="token inserted">+ import exampleText from \'./example.txt\';</span>\n\n<span class="token deleted">- block.style.background = `url(${metroMap}); // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)</span>\n<span class="token inserted">+ block.textContent = exampleText; // \'Hello world\'</span></code></pre>\n<p>所有 <code>.txt</code> 文件将原样注入到 bundle 中。</p>\n<h2 id="通用资源类型general-asset-type">通用资源类型(general asset type)<a href="#%E9%80%9A%E7%94%A8%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8Bgeneral-asset-type" aria-hidden="true"><span class="icon icon-link"></span></a></h2>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\')\n  },\n  experiments: {\n    asset: true\n  },\n  module: {\n    rules: [\n      {\n<span class="token inserted">+       test: /\\.txt/,</span>\n<span class="token inserted">+       type: \'asset\',</span>\n      }\n    ]\n  },\n};</code></pre>\n<p>现在，webpack 将按照默认条件，自动地在 <code>resource</code> 和 <code>inline</code> 之间进行选择：小于 8kb 的文件，将会视为 <code>inline</code> 模块类型，否则会被视为 <code>resource</code> 模块类型。</p>\n<p>可以通过在 webpack 配置的 module rule 层级中，设置 <a href="/configuration/module/#ruleparserdataurlcondition"><code>Rule.parser.dataUrlCondition.maxSize</code></a> 选项来修改此条件：</p>\n<p><strong>webpack.config.js</strong></p>\n<pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index.js\',\n  output: {\n    filename: \'main.js\',\n    path: path.resolve(__dirname, \'dist\')\n  },\n  experiments: {\n    asset: true\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.txt/,\n        type: \'asset\',\n<span class="token inserted">+       parser: {</span>\n<span class="token inserted">+         dataUrlCondition: {</span>\n<span class="token inserted">+           maxSize: 4 * 1024 // 4kb</span>\n<span class="token inserted">+         }</span>\n<span class="token inserted">+       }</span>\n      }\n    ]\n  },\n};</code></pre>\n<p>还可以 <a href="/configuration/module/#ruleparserdataurlcondition">指定一个函数</a> 来决定是否 inline 模块。</p>\n'}}]);